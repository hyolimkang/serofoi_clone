<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="serofoi">
<title>FoI Models â€¢ serofoi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="FoI Models">
<meta property="og:description" content="serofoi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">serofoi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/serofoi.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/foi_models.html">FoI Models</a>
    <a class="dropdown-item" href="../articles/use_cases.html">Use Cases</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>FoI Models</h1>
            
      
      
      <div class="d-none name"><code>foi_models.Rmd</code></div>
    </div>

    
    
<p>The current version of <strong><em>serofoi</em></strong> supports
three different models for estimating the <em>Force-of-Infection
(FoI)</em>, including constant and time-varying trajectories. For
fitting the model to the sero-prevalence data we use a suit of bayesian
models that include prior and upper prior distributions</p>
<div class="section level2">
<h2 id="what-is-the-force-of-infection">What is the Force-of-Infection<a class="anchor" aria-label="anchor" href="#what-is-the-force-of-infection"></a>
</h2>
<p>The force of infection, also known as the hazard rate or the
infection pressure, is a key concept in mathematical modelling of
infectious diseases. It represents the rate at which susceptible
individuals become infected, given their exposure to a pathogen. In
simple terms, the force of infection quantifies the risk of a
susceptible individual becoming infected over a period of time. It is
usually expressed as a rate per unit of time (e.g., per day or per
year).</p>
</div>
<div class="section level2">
<h2 id="constant-vs-time-varying-foi">Constant vs Time-varying FoI<a class="anchor" aria-label="anchor" href="#constant-vs-time-varying-foi"></a>
</h2>
<p>The <em>FoI</em> is one of the most important parameters in
epidemiology, but it is often incorrectly assumed to be constant over
time. Identifying whether the <em>FoI</em> follows a constant or a
time-varying trend can be important in the identification and
characterization of the spread of disease. In Table 1 there is a summary
of the models currently supported by serofoi.</p>
<div class="l-body-outset">
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th>Model Option</th>
<th align="center">Description and usage</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>constant</code></td>
<td align="center">Constant FoI</td>
</tr>
<tr class="even">
<td><code>tv_normal</code></td>
<td align="center">Time-varying normal FoI: slow change in FoI</td>
</tr>
<tr class="odd">
<td><code>tv_normal_log</code></td>
<td align="center">Time-varying normal-log FoI: fast epidemic change in
FoI</td>
</tr>
</tbody>
</table>
</div>
<p>Table 1. Model options and descriptions.</p>
</div>
<div class="section level2">
<h2 id="model-1--constant-force-of-infection-endemic-model">Model 1. Constant Force-of-Infection (endemic model)<a class="anchor" aria-label="anchor" href="#model-1--constant-force-of-infection-endemic-model"></a>
</h2>
<p>The <em>endemic constant model</em> is a simple mathematical model
used in epidemiology to describe the seroprevalence of an infectious
disease within a population, as a product of a long-term
transmission.</p>
<p>For a constant FoI endemic model, the rate of infection acquisition
<span class="math inline">\(\lambda\)</span> is constant over time for
each trajectory, and the seroprevalence <span class="math inline">\(P\)</span> behaves as a cumulative process
increasing monotonically with age. For the seroprevalence at age <span class="math inline">\(a\)</span> and time <span class="math inline">\(t\)</span>, we have: <span class="math display">\[
P(a,t) = 1-\exp\left(-\lambda a\right)
\]</span> The number of positive cases follows a binomial distribution,
where <span class="math inline">\(n\)</span> is the number of trials
(size of the age group) and <span class="math inline">\(P\)</span> is
the probability of successes (seroprevalence) for a certain age group:
<span class="math display">\[
p(a,t) \sim binom(n(a,t), P(a,t))
\]</span> In <strong><em>serofoi</em></strong>, for the constant model,
the <em>FoI</em> (<span class="math inline">\(\lambda\)</span>) is
modelled within a Bayesian framework using a uniform prior distribution
<span class="math inline">\(\sim U(0,2)\)</span>. Future versions of the
package may allow to choose different default distributions. This model
can be implemented for the previously prepared dataset
<code>data_test</code> by means of the <code>run_seromodel</code>
function specifying <code>run_seromodel="constant"</code>.</p>
<p>The object <code>simdata_constant</code> contains a minimal simulated
dataset that emulates an hypothetical endemic situation where the
<em>FoI</em> is constant with value 0.2 and includes data for 250
samples of individuals between 2 and 47 years old with a number of
trials <span class="math inline">\(n=5\)</span>. The following code
shows how to implement the constant model to this simulated
serosurvey:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simdata_constant"</span><span class="op">)</span></span>
<span><span class="va">serodata_constant</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_serodata.html">prepare_serodata</a></span><span class="op">(</span><span class="va">simdata_constant</span><span class="op">)</span></span>
<span><span class="va">model_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_seromodel.html">run_seromodel</a></span><span class="op">(</span>serodata <span class="op">=</span> <span class="va">serodata_constant</span>,</span>
<span>                         foi_model <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>                         n_iters <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_seromodel.html">plot_seromodel</a></span><span class="op">(</span><span class="va">model_1</span>, size_text <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><img src="foi_models_files/figure-html/model_1_plot-1.png" width="50%" style="display: block; margin: auto;">
Figure 1. Constant serofoi model plot. Simulated (red) vs modelled
(blue) <em>FoI</em>.</p>
<p>In this case, 800 iterations are enough to ensure convergence. The
<code>plot_seromodel</code> method provides a visualisation of the
results, including a summary where the expected log pointwise predictive
density (<code>elpd</code>) and its standard error (<code>se</code>) are
shown. We say that a model converges if all the R-hat estimates are
below 1.1.</p>
</div>
<div class="section level2">
<h2 id="time-varying-foi-models">Time-varying FoI models<a class="anchor" aria-label="anchor" href="#time-varying-foi-models"></a>
</h2>
<p>For the time-varying <em>FoI</em> models, the probability for a case
to be positive at age a at time <span class="math inline">\(t\)</span>
also follows a binomial distribution, as described above. However, the
seroprevalence is obtained from a cumulative of the yearly-varying
values of the <em>FoI</em> over time: <span class="math display">\[
P(a,t) = 1 - \exp\left(-\sum_{i=t-a+1}^{t}\lambda_i\right)
\]</span> The corresponding serosurvey completed at time <span class="math inline">\(t_{sur}\)</span> is informative for the interval
<span class="math inline">\([t_{sur}-a_{max}, t_{sur}]\)</span>.</p>
</div>
<div class="section level2">
<h2 id="model-2--time-varying-foi---slow-time-varying-foi">Model 2. Time-varying FoI - Slow Time-Varying FoI<a class="anchor" aria-label="anchor" href="#model-2--time-varying-foi---slow-time-varying-foi"></a>
</h2>
<p>The <em>time-varying slow normal model</em> relies on the following
prior distributions for the <em>FoI</em> to describe the spread of a
given infectious disease within a population over time: <span class="math display">\[
\lambda(t)\sim normal(\lambda(t-1), \sigma) \\
\lambda(t=1) \sim normal(0, 1)
\]</span> The object <code>simdata_sw_dec</code> contains a minimal
simulated dataset that emulates a situation where the <em>FoI</em>
follows a stepwise decreasing tendency (<em>FoI</em> panel in Fig. 2).
The simulated dataset contains information about 250 samples of
individuals between 2 and 47 years old with a number of trials <span class="math inline">\(n=5\)</span>. The following code shows how to
implement the slow time-varying normal model to this simulated
serosurvey:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simdata_sw_dec"</span><span class="op">)</span></span>
<span><span class="va">serodata_sw_dec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_serodata.html">prepare_serodata</a></span><span class="op">(</span><span class="va">simdata_sw_dec</span><span class="op">)</span></span>
<span><span class="va">model_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_seromodel.html">run_seromodel</a></span><span class="op">(</span>serodata <span class="op">=</span> <span class="va">serodata_sw_dec</span>,</span>
<span>                         foi_model <span class="op">=</span> <span class="st">"tv_normal"</span>,</span>
<span>                         n_iters <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_seromodel.html">plot_seromodel</a></span><span class="op">(</span><span class="va">model_2</span>, size_text <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><img src="foi_models_files/figure-html/model_2_plot-1.png" width="50%" style="display: block; margin: auto;">
Figure 2. Slow time-varying serofoi model plot. Simulated (red) vs
modelled (blue) <em>FoI</em>.</p>
<p>The number of iterations required may depend on the number of years,
reflected by the difference between the year of the serosurvey and the
maximum age-class sampled.</p>
</div>
<div class="section level2">
<h2 id="model-3--time-varying-foi---fast-epidemic-model">Model 3. Time-varying FoI - Fast Epidemic Model<a class="anchor" aria-label="anchor" href="#model-3--time-varying-foi---fast-epidemic-model"></a>
</h2>
<p>The <em>time-varying fast epidemic model</em>, relies on normal prior
distributions for the <em>FoI</em> in the logarithmic scale, i.e: <span class="math display">\[
\lambda(t)\sim normal(\log(\lambda(t-1)), \sigma) \\
\lambda(t=1) \sim normal(-6, 4)
\]</span> This is done in order to capture fast changes in the
<em>FoI</em> trend. Importantly, the standard deviation parameter of
this normal distribution of the <em>FoI</em> <span class="math inline">\(\lambda(t)\)</span> is set using an upper prior
that follows a Cauchy distribution.</p>
<p>In order to test this model we use the minimal simulated dataset
contained in the <code>simdata_large_epi</code> object. This dataset
emulates a hypothetical situation where a three-year epidemic occurs
between 2032 and 2035. The simulated serosurvey tests 250 individuals
from 0 to 50 years of age in the year 2050. The implementation of the
fast epidemic model can be obtained running the following lines of
code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simdata_large_epi"</span><span class="op">)</span></span>
<span><span class="va">serodata_large_epi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_serodata.html">prepare_serodata</a></span><span class="op">(</span><span class="va">simdata_large_epi</span><span class="op">)</span></span>
<span><span class="va">model_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_seromodel.html">run_seromodel</a></span><span class="op">(</span>serodata <span class="op">=</span> <span class="va">serodata_large_epi</span>,</span>
<span>                         foi_model <span class="op">=</span> <span class="st">"tv_normal_log"</span>,</span>
<span>                         n_iters <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span>
<span><span class="va">model_3_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_seromodel.html">plot_seromodel</a></span><span class="op">(</span><span class="va">model_3</span>, size_text <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_3_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="foi_models_files/figure-html/model_3_plot-1.png" width="50%" style="display: block; margin: auto;">
Figure 3. <em>Time-varying fast epidemic serofoi model</em> plot.
Simulated (red) vs modelled (blue) <em>FoI</em>.</p>
<p>In Fig 3 we can see that the <em>fast epidemic serofoi model</em> is
able to identify the large epidemic simulated on the
<code>simdata_large_epi</code> dataset.</p>
</div>
<div class="section level2">
<h2 id="models-comparison">Models Comparison<a class="anchor" aria-label="anchor" href="#models-comparison"></a>
</h2>
<p>The statistical details of the three models are described in Table
2.</p>
<div class="l-body-outset">
<table class="table">
<colgroup>
<col width="11%">
<col width="28%">
<col width="41%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="left">Model Option</th>
<th align="left">Probability of positive case at age <span class="math inline">\(a\)</span>
</th>
<th align="left">Prior distribution</th>
<th align="left">Upper priors</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>constant</code></td>
<td align="left"><span class="math inline">\(\sim binom(n(a,t),
P(a,t))\)</span></td>
<td align="left"><span class="math inline">\(\lambda\sim
uniform(0,2)\)</span></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>tv_normal</code></td>
<td align="left"><span class="math inline">\(\sim binom(n(a,t),
P(a,t))\)</span></td>
<td align="left"><span class="math inline">\(\lambda\sim
normal(\lambda(t-1),\sigma)\\  \lambda(t=1)\sim
normal(0,1)\)</span></td>
<td align="left"><span class="math inline">\(\sigma\sim
Cauchy(0,1)\)</span></td>
</tr>
<tr class="odd">
<td align="left"><code>tv_normal_log</code></td>
<td align="left"><span class="math inline">\(\sim binom(n(a,t),
P(a,t))\)</span></td>
<td align="left"><span class="math inline">\(\lambda\sim
normal(log(\lambda(t-1)),\sigma)\\  \lambda(t=1)\sim
normal(-6,4)\)</span></td>
<td align="left"><span class="math inline">\(\sigma\sim
Cauchy(0,1)\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>Table 2. Statistical characteristics of
<strong><em>serofoi</em></strong>â€™s currently supported models for the
FoI (<span class="math inline">\(\lambda\)</span>). Here <span class="math inline">\(n\)</span> is the size of an age group <span class="math inline">\(a\)</span> at time-step <span class="math inline">\(t\)</span> and <span class="math inline">\(P\)</span> is its corresponding
seroprevalence.</p>
<p>Above we showed that the fast epidemic model
(<code>tv_normal_log</code>) is able to identify the large epidemic
outbreak described by the <code>simdata_large_epi</code> dataset, which
was simulated according to a step-wise decreasing <em>FoI</em> (red line
in Fig 3).</p>
<p>Now, we would like to know whether this model actually fits this
dataset better than the other available models in
<strong><em>serofoi</em></strong>. For this, we also implement both the
endemic model (<code>constant</code>) and the slow time-varying normal
model (<code>tv_normal</code>):</p>
<p>Using the function <code><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">cowplot::plot_grid</a></code> we can visualise
the results of the three models simultaneously:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">model_1_plot</span>, <span class="va">model_2_plot</span>, <span class="va">model_3_plot</span>,</span>
<span>                   nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="st">"AUTO"</span><span class="op">)</span></span></code></pre></div>
<p><img src="foi_models_files/figure-html/model_comparison_plot_-1.png" width="480" style="display: block; margin: auto;">
Figure 4. Model comparison between the three serofoi models for a
large-epidemic simulated dataset.</p>
<p>A common criterion to decide what model fits the data the best is to
choose the one with the larger <code>elpd</code>. According to this
criterion, in this case the best model is the fast epidemic model, which
is the only one that manages to identify the large epidemic (see the
second row of panel C in Figure 4).</p>
<p>NOTE: Running the <strong><em>serofoi</em></strong> models for the
first time on your local computer may take a few minutes for the rstan
code to compile locally. However, once the initial compilation is
complete, there is no further need for local compilation.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Zulma M. CucunubÃ¡, NicolÃ¡s Torres, Ben Lambert, Pierre Nouvellet.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
